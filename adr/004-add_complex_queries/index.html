
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Lyz">
      
      
        <link rel="canonical" href="https://lyz-code.github.io/repository-orm/adr/004-add_complex_queries/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>Status - Repository ORM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/links.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#status" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Repository ORM" class="md-header__button md-logo" aria-label="Repository ORM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Repository ORM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Status
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lyz-code/repository-orm/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lyz-code/repository-orm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Repository ORM" class="md-nav__button md-logo" aria-label="Repository ORM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Repository ORM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lyz-code/repository-orm/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lyz-code/repository-orm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Repository ORM
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../repositories/">Repositories</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Repositories" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Repositories
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fake_repository/" class="md-nav__link">
        FakeRepository
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tinydb_repository/" class="md-nav__link">
        TinyDBRepository
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pypika_repository/" class="md-nav__link">
        PypikaRepository
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../file_repositories/">File Repositories</a>
          
        </div>
      
      <nav class="md-nav" aria-label="File Repositories" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          File Repositories
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../local_file_repository/" class="md-nav__link">
        LocalFileRepository
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        Models
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference_adapters/" class="md-nav__link">
        Repository Implementations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference_models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference_exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../contributing/">Contributing</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Contributing" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../new_repo/" class="md-nav__link">
        Create new repository
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../adr/">Architecture Decision Records</a>
          
            <label for="__nav_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Architecture Decision Records" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Architecture Decision Records
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../001-entity_id_definition.md
" class="md-nav__link">
        001: Entity id_ definition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../002-support_string_ids.md
" class="md-nav__link">
        002: String id_ support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../003-make_entity_models_optional_arguments.md
" class="md-nav__link">
        003: Make entity_models optional arguments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposals" class="md-nav__link">
    Proposals
  </a>
  
    <nav class="md-nav" aria-label="Proposals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-builder" class="md-nav__link">
    Query builder
  </a>
  
    <nav class="md-nav" aria-label="Query builder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-to-extract-data-from" class="md-nav__link">
    Table to extract data from
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fields-to-extract" class="md-nav__link">
    Fields to extract
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#condition-to-select-the-objects" class="md-nav__link">
    Condition to select the objects
  </a>
  
    <nav class="md-nav" aria-label="Condition to select the objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-query-operators" class="md-nav__link">
    Simple query operators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-composition" class="md-nav__link">
    Query composition
  </a>
  
    <nav class="md-nav" aria-label="Query composition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#or" class="md-nav__link">
    OR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#and" class="md-nav__link">
    AND
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join" class="md-nav__link">
    Join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sorting-the-results" class="md-nav__link">
    Sorting the results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#number-of-results" class="md-nav__link">
    Number of results
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-queries" class="md-nav__link">
    Delete queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    Decision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consequences" class="md-nav__link">
    Consequences
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/lyz-code/repository-orm/edit/master/docs/adr/004-add_complex_queries.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



  <h1>Status</h1>

<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<!-- What is the status? Draft, Proposed, Accepted, Rejected, Deprecated or Superseded?
-->
<p>Draft</p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<!-- What is the issue that we're seeing that is motivating this decision or change? -->
<p>Right now the <code>search</code> method only allows a dictionary of keys that the objects
must match, this way of selecting objects has become insufficient for the
programs that use the library forcing them to extract from the repository
a greater subset of objects that contain a serie of attributes and then do
another filtering afterwards. This is the case for example when the user wants
to select objects that:</p>
<ul>
<li>Have a datetime or integer greater or smaller than an amount.</li>
<li>Don't have an attribute with a defined value</li>
<li>Match a combination of criteria, for example:<ul>
<li>Have an attribute with a value and another that is greater than X</li>
<li>Have an attribute with a value and another that doesn't contain the value
    Y.</li>
</ul>
</li>
<li>Match a criteria on a related object (<code>JOIN</code> operations).</li>
</ul>
<p>This schema has the next disadvantages:</p>
<ul>
<li>The user is constrained to a very basic query type</li>
<li>The repository returns more objects than the user needs, so more traffic is
    sent between the application and the database</li>
<li>The user needs to do an extra filter afterwards. This is a bad idea because
    doing the filtering at databases level probably gives better performance
    and the user needs to write more code than necessary.</li>
</ul>
<h2 id="proposals">Proposals<a class="headerlink" href="#proposals" title="Permanent link">&para;</a></h2>
<!-- What are the possible solutions to the problem described in the context -->

<p>Change the way we let the user specify the criteria that it wants to search so
that it can do more powerful searches. I can think of two ways of doing this:</p>
<ul>
<li>Writing the query in a string and parsing it afterwards.</li>
<li>Writing the query with a query builder.</li>
</ul>
<p>Given <a href="https://lyz-code.github.io/blue-book/architecture/orm_builder_query_or_raw_sql/">this
analysis</a>,
the query builder system looks better.</p>
<h3 id="query-builder">Query builder<a class="headerlink" href="#query-builder" title="Permanent link">&para;</a></h3>
<p>We will create a <code>Query</code> object that follows the theory of <a href="https://lyz-code.github.io/blue-book/architecture/orm_builder_query_or_raw_sql/#query-builder">query
builders</a>.</p>
<p>Right now queries make sense only to extract data from the database, so speaking
in SQL terms, only <code>SELECT</code> and <code>DELETE</code> queries are interesting for us. To do
a select query you need:</p>
<ul>
<li><a href="#table-to-extract-data-from">The table to extract data from</a></li>
<li><a href="#fields-to-extract">The fields to extract</a></li>
<li><a href="#condition-to-select-objects">The condition to select the rows</a></li>
<li><a href="#sorting-the-results">The sorting method of the results</a></li>
<li><a href="#number-of-results">The number of results to return</a></li>
</ul>
<p>All of the <code>Query</code> methods return <code>self</code> in order to be able to construct it
with chained methods and properties. Those methods that don't need an argument
will be coded as properties to save keystrokes on unneeded <code>()</code>.</p>
<h4 id="table-to-extract-data-from">Table to extract data from<a class="headerlink" href="#table-to-extract-data-from" title="Permanent link">&para;</a></h4>
<p>Applied to the <code>repository_orm</code> usage, the <code>FROM</code> is defined by the model class both
to extract the table name, build the end objects and let the type checker know
what type of objects it's returning, so we need to pass the class of the model
to the <code>search</code> and <code>all</code> methods. It makes sense then to pass the argument at
initialization time of the <code>Query</code> object.</p>
<h4 id="fields-to-extract">Fields to extract<a class="headerlink" href="#fields-to-extract" title="Permanent link">&para;</a></h4>
<p>In our case it doesn't make sense to let the user select the fields it wants to
extract, as we return built objects and not just the values of the rows.</p>
<h4 id="condition-to-select-the-objects">Condition to select the objects<a class="headerlink" href="#condition-to-select-the-objects" title="Permanent link">&para;</a></h4>
<h5 id="simple-query-operators">Simple query operators<a class="headerlink" href="#simple-query-operators" title="Permanent link">&para;</a></h5>
<p>Assuming that <code>query = Query(Model)</code> there are the next methods to select the
data, it will return the objects if:</p>
<ul>
<li><code>equal</code>: Attribute match value.</li>
<li><code>not_equal</code>: Attribute doesn't match value.</li>
<li><code>greater</code>: Attribute is greater than value.</li>
<li><code>greater_or_equal</code>: Attribute is greater or equal than value.</li>
<li><code>smaller</code>: Attribute is smaller than value.</li>
<li><code>smaller_or_equal</code>: Attribute is smaller or equal than value.</li>
</ul>
<p>To act on one attribute and one value you can use <code>query.method(attribute,
value)</code>, for example <code>query.equal('id_', 3)</code>. To act on many attributes you can
use <code>query.method({attribute1: value1, attribute2: value2})</code>, for example
<code>query.greater({'rating': 3, 'created_at': datetime.datetime.now()})</code>.</p>
<h5 id="query-composition">Query composition<a class="headerlink" href="#query-composition" title="Permanent link">&para;</a></h5>
<p>If you concatenate methods and properties on a query they are supposed to be
conditions that all objects must match.</p>
<h6 id="or">OR<a class="headerlink" href="#or" title="Permanent link">&para;</a></h6>
<p><code>or</code> can be used to match one or many conditions but not others. You have to
select two types of criteria, so you need to <code>Query</code> objects.</p>
<p><code>query.greater('rating', 3).or(Query().smaller('rating', 1))</code></p>
<p>Note that if the second <code>Query</code> isn't initialized with a model, it will be
assumed to be the same as the first one.</p>
<h6 id="and">AND<a class="headerlink" href="#and" title="Permanent link">&para;</a></h6>
<p><code>and</code> can be used if you want to select different criteria for different
objects:</p>
<div class="highlight"><pre><span></span><code><span class="n">Query</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="ow">and</span><span class="p">(</span><span class="n">Query</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="s1">&#39;id_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div>
<h6 id="join">Join<a class="headerlink" href="#join" title="Permanent link">&para;</a></h6>
<p><code>join</code> can be used to match entities if an entity that is related to them
matches one or many condition, for example to get all the books of the author
whose <code>id</code> is <code>1</code> you can:</p>
<div class="highlight"><pre><span></span><code><span class="n">Query</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Query</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="s1">&#39;id_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div>
<h4 id="sorting-the-results">Sorting the results<a class="headerlink" href="#sorting-the-results" title="Permanent link">&para;</a></h4>
<p>By default the results are sorted by <code>id_</code> increasingly, to sort by other
criteria use the <code>sort</code> method.</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">)</span>
</code></pre></div>
<p>To reverse the order of the sorting use the <code>reverse</code> argument:</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>To order by many criteria chain <code>sort</code> methods, for example if you want to sort
by <code>rating</code> and then by <code>created_date</code> you can use:</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;created_date&#39;</span><span class="p">)</span>
</code></pre></div>
<h4 id="number-of-results">Number of results<a class="headerlink" href="#number-of-results" title="Permanent link">&para;</a></h4>
<p>By default all results are returned, if you want to receive only a limited
amount use the <code>limit</code> method</p>
<div class="highlight"><pre><span></span><code><span class="n">query</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<h4 id="delete-queries">Delete queries<a class="headerlink" href="#delete-queries" title="Permanent link">&para;</a></h4>
<p>Right now the <code>delete</code> method allows only one or many entities, we can change
the signature so that it also allows a <code>Query</code> object that can tweak the delete
query instead of just using the <code>id_</code>.</p>
<h2 id="decision">Decision<a class="headerlink" href="#decision" title="Permanent link">&para;</a></h2>
<!-- What is the change that we're proposing and/or doing? -->

<p>Implement the proposed solution, adding a <code>UserWarning</code> on the old method until
we deprecate it.</p>
<h2 id="consequences">Consequences<a class="headerlink" href="#consequences" title="Permanent link">&para;</a></h2>
<!-- What becomes easier or more difficult to do because of this change? -->

<p>Pros:</p>
<ul>
<li>We'll improve a lot the extraction of information from the repo</li>
</ul>
<p>Cons:</p>
<p>Users will need to change their code:</p>
<ul>
<li>How they query the repositories.</li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2022-03-10T13:09:29+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-03-10</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.top", "content.code.annotate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.467223ff.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>